<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" 
      xmlns:h="http://java.sun.com/jsf/html" 
      xmlns:p="http://primefaces.org/ui"
	  xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:f="http://java.sun.com/jsf/core">

	<ui:param name="crtPatient" value="#{office.patientManagment.createPatient}"></ui:param>
	<ui:param name="crtAddress" value="#{office.patientManagment.createAddress}"></ui:param>
	<ui:param name="crtCInfo" value="#{office.patientManagment.createContactInfo}"></ui:param>	
	<ui:param name="sltPatient" value="#{office.patientManagment.selectedPatient}"></ui:param>

	<!-- NEW PATIENT PANEL -->	
	<p:panel header="New Patient" >
		<h:panelGrid id="grid" columns="7">
			<h:outputText value="Name: " />
			<p:inputText id="name" value="#{crtPatient.name}" required="true" requiredMessage="Name is required"  />
			<h:outputText value="Surname: " />
			<p:inputText id="surname" value="#{crtPatient.surname}" required="true" requiredMessage="Surname is required"/>
			<h:outputText value="Comments: " />
			<p:inputText id="comment" value="#{crtPatient.comments}" />
			<p:commandButton value="Create" id="crtBtn" 
						process="@this,name,surname,comment" 
						update="patientList"
						actionListener="#{office.patientManagment.createPatient()}" />
		</h:panelGrid>
	</p:panel>

	<!-- PATIENT TABLE -->
	<p:dataTable id="patientList" var="patient" value="#{office.patientManagment.patientList}"    
		rowKey="#{patient.id}"  selection="#{sltPatient}" selectionMode="single" styleClass="patientList">
		<p:column headerText="Surname" sortBy="#{patient.surname}" width="200">
			#{patient.surname}  
		</p:column>
		<p:column headerText="Name" sortBy="#{patient.name}" width="200">
			#{patient.name}  
		</p:column>
		<p:column headerText="Created" sortBy="#{patient.created}" width="200">
			#{patient.created}  
		</p:column>
		<p:column headerText="Billing address" width="200">
			#{patient.billingAddress.UIFriendlyString}  
		</p:column>
		<p:column headerText="Home address" width="200">
			#{patient.homeAddress.UIFriendlyString}  
		</p:column>
		<p:column headerText="Fax" width="200">
			#{patient.fax.info}  
		</p:column>
		<p:column headerText="Email" width="200">
			#{patient.email.info}  
		</p:column>
		
	</p:dataTable>

	<!-- PATIENT TABLE RIGHT-CLICK MENU -->
 	<p:contextMenu for="patientList">
 	    <p:menuitem value="Add Contact Info" icon="ui-icon-check" process="patientList" 
 	    			oncomplete="cinfoDlg.show()" update="cinfoDialog"/>  
        <p:menuitem value="Add Address" icon="ui-icon-check" process="patientList" 
        			oncomplete="adrsDlg.show()" update="addressDialog"/>
        <p:menuitem value="Details" icon="ui-icon-check" process="patientList" 
        			oncomplete="dtlDlg.show()" update="detailsDialog"/>
        <p:menuitem value="Delete" icon="ui-icon-close" process="@this,patientList" 
        			actionListener="#{office.patientManagment.deletePatient}" 
        			update="patientList,scheduler"/>
    </p:contextMenu>  

	<!--  CREATE ADDRESS DIALOG -->
    <p:dialog id="addressDialog" header="New Address for #{sltPatient.surname}" 
    		  widgetVar="adrsDlg" height="350" >
    	<p:panelGrid columns="2">
		    <h:outputLabel value="Country" for="adrsCountry"/>
		    <h:inputText id="adrsCountry" value="#{crtAddress.country}" />
    		<h:outputLabel value="City" for="adrsCity"/>
		    <h:inputText id="adrsCity" value="#{crtAddress.city}" />
		    <h:outputLabel value="Stret" for="adrsStreet"/>
		    <h:inputText id="adrsStreet" value="#{crtAddress.street}" />
		    <h:outputLabel value="Number" for="adrsNumber"/>
		    <h:inputText id="adrsNumber" value="#{crtAddress.number}" />
		    <h:outputLabel value="Postal Code" for="adrsPCode"/>
		    <h:inputText id="adrsPCode" value="#{crtAddress.postalcode}" />
	        <h:outputLabel value="Address Type" for="adrsType"/>
	        <p:selectOneMenu id="adrsType" value="#{crtAddress.id.adrstype}">  
	            <f:selectItem itemLabel="Select One" itemValue="" />  
	            <f:selectItem itemLabel="Home" itemValue="0" />  
	            <f:selectItem itemLabel="Office" itemValue="1" />  
	            <f:selectItem itemLabel="Billing" itemValue="2" />  
	        </p:selectOneMenu>  

		    <p:commandButton value="Create" id="crtAdrsBtn" 
		    				 process="@this,adrsCity,adrsCountry,adrsNumber,adrsPCode,adrsStreet,adrsType" 
		    				 update="patientList" 
						 	 actionListener="#{office.patientManagment.createAddress()}" 
						 	 oncomplete="adrsDlg.hide()"/>
    	</p:panelGrid>
    </p:dialog>
    
    <!--  CREATE CONTACT INFO DIALOG -->
    <p:dialog id="cinfoDialog" header="New Contact Info for #{sltPatient.surname}" 
    		  widgetVar="cinfoDlg" height="400" >
    	<p:panelGrid columns="2">
		    <h:outputLabel value="Contact Information " for="contactInfo"/>
		    <h:inputText id="contactInfo" value="#{crtCInfo.info}" />
		    <h:outputLabel value="Type" for="cinfoType"/>  
	        <p:selectOneMenu id="cinfoType" value="#{crtCInfo.id.infotype}">  
	            <f:selectItem itemLabel="Select One" itemValue="" />  
	            <f:selectItem itemLabel="E-mail" itemValue="0" />  
	            <f:selectItem itemLabel="Fax" itemValue="1" />  
	            <f:selectItem itemLabel="Home" itemValue="2" />  
	            <f:selectItem itemLabel="Office" itemValue="3" />
	            <f:selectItem itemLabel="Mobile" itemValue="4" />
	        </p:selectOneMenu>  
		    <p:commandButton value="Create" id="crtCInfoBtn" 
		    				 process="@this,contactInfo,cinfoType" 
		    				 update="patientList" 
						 	 actionListener="#{office.patientManagment.createContactInfo()}" 
						 	 oncomplete="cinfoDlg.hide()"/>
    	</p:panelGrid>
    </p:dialog>
    
    <!-- PATIENT DETAILS DIALOG -->
    <p:dialog id="detailsDialog" header="Patient Details" widgetVar="dtlDlg" height="140" >
    	<p:panelGrid columns="1">
		    <h:outputLabel id="dtlSurname" value="#{sltPatient.surname}" />
		    <h:outputLabel id="dtlName" value="#{sltPatient.name}" />
		    <h:outputLabel id="dtlCreated" value="#{sltPatient.created}" />
		    <h:outputLabel id="dtlComments" value="#{sltPatient.comments}" />
    	</p:panelGrid>
    </p:dialog>
</html>
